{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>Professor List</h1>
    <a href="{{ url_for('add_professor') }}" class="btn btn-primary" title="Add professor" aria-label="Add professor">
    <i class="bi bi-plus-lg" aria-hidden="true"></i> Add Professor
    <span class="visually-hidden">Add professor</span>
    </a>
</div>

<!-- Search and Filter Section -->
<div class="card mb-4">
  <div class="card-body">
    <div class="d-flex flex-wrap align-items-center gap-2 justify-content-between">
      <h5 class="mb-0">Find Professors</h5>
      <div class="d-flex gap-2">
        <select class="form-select form-select-sm" id="sortBy" aria-label="Sort by">
          <option value="">Sort by…</option>
          <option value="name-asc">Name (A→Z)</option>
          <option value="name-desc">Name (Z→A)</option>
          <option value="ranking-asc">Ranking (low→high)</option>
          <option value="ranking-desc">Ranking (high→low)</option>
        </select>
        <button class="btn btn-outline-secondary btn-sm" onclick="clearFilters()">Clear</button>
      </div>
    </div>

    <!-- Primary search row: name/location + key filters -->
    <div class="mt-3">
        <div class="search-grid">
            <input type="text" class="form-control" id="globalSearch"
                placeholder="Search by name or location…" aria-label="Search by name or location">

            <select class="form-select" id="filterHiringStatus" aria-label="Filter by hiring status">
            <option value="">All Hiring Status</option>
            <option value="Hiring">Hiring</option>
            <option value="Not Hiring">Not Hiring</option>
            <option value="Information Unavailable">Information Unavailable</option>
            </select>

            <input type="text" class="form-control" id="filterProgram" placeholder="Filter by program…">
            <input type="text" class="form-control" id="filterResearchArea" placeholder="Filter by research area…">
        </div>
    </div>

    <div class="mt-2">
    <button class="btn btn-link p-0" type="button" data-bs-toggle="collapse" data-bs-target="#advancedFilters" aria-expanded="false">
        Advanced filters
    </button>

    <div class="collapse" id="advancedFilters">
        <div class="advanced-grid mt-1">
        <input type="text" class="form-control" id="filterTitle" placeholder="Filter by title…">
        <input type="text" class="form-control" id="filterUniversity" placeholder="Filter by university…">
        <input type="text" class="form-control" id="filterDepartment" placeholder="Filter by department…">
        <select class="form-select" id="filterContactMethod" aria-label="Filter by contact method">
            <option value="">All Contact Methods</option>
            <option value="Email">Email</option>
            <option value="Application">Application</option>
            <option value="Form">Form</option>
        </select>
        <!-- Add more advanced filters here; they will auto-flow evenly -->
        </div>
    </div>
    </div>
  </div>
</div>

<table class="table table-striped" id="professorTable">
    <thead>
        <tr>
            <th>Name</th>
            <th>Title</th>
            <th>University</th>
            <th>University Rank (US News)</th>
            <th>Location</th>
            <th>Department</th>
            <!-- <th>Programs</th> -->
            <th>Research Areas</th>
            <!-- <th>Email</th> -->
            <th>Hiring Status</th>
            <!-- <th>Contact Method</th> -->
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for prof in professors %}
        <tr data-name="{{ prof.name|lower }}" 
            data-title="{{ prof.title|lower }}"
            data-university="{{ prof.university.name|lower if prof.university else '' }}" 
            data-department="{{ prof.department.name|lower if prof.department else '' }}"
            data-hiring-status="{{ prof.hiring_status.value|lower }}"
            data-contact-method="{{ prof.contact_through.value|lower }}"
            data-email="{{ prof.email|lower }}"
            data-country="{{ prof.university.country|lower if prof.university else '' }}"
            data-city="{{ prof.university.city|lower if prof.university else '' }}"
            data-state="{{ prof.university.state|lower if prof.university else '' }}"
            data-ranking="{{ prof.university.ranking_usnews|string if prof.university and prof.university.ranking_usnews else '' }}">
            <td>{{ prof.name }}</td>
            <td>{{ prof.title }}</td>
            <td>{{ prof.university.name if prof.university else 'N/A' }}</td>
            <td>{{ prof.university.ranking_usnews }}</td>
            <td>
                {% if prof.university %}
                    {% if prof.university.city %}{{ prof.university.city }}{% endif %}{% if prof.university.state %}, {{ prof.university.state }}{% endif %}{% if prof.university.country %}, {{ prof.university.country }}{% endif %}
                {% else %}
                    N/A
                {% endif %}
            </td>
            <td>{{ prof.department.name if prof.department else 'N/A' }}</td>
            <!-- <td class="programs-cell" data-programs="{{ prof.programs|map(attribute='name')|join(',')|lower }}">
                {% for prog in prof.programs %}
                    <span class="badge bg-secondary me-1">{{ prog.name }}</span>
                {% endfor %}
            </td> -->
            <td class="research-areas-cell" data-research-areas="{{ prof.research_areas|map(attribute='name')|join(',')|lower }}">
                {% for area in prof.research_areas %}
                    <span class="badge bg-info me-1">{{ area.name }}</span>
                {% endfor %}
            </td>
            <!-- <td>{{ prof.email }}</td> -->
            <td>
                <span class="badge 
                    {% if prof.hiring_status.value == 'Hiring' %}bg-success
                    {% elif prof.hiring_status.value == 'Not Hiring' %}bg-danger
                    {% else %}bg-warning text-dark
                    {% endif %}">
                    {{ prof.hiring_status.value }}
                </span>
            </td>
            <!-- <td>{{ prof.contact_through.value }}</td> -->
            <td>
                <button class="btn btn-sm btn-outline-primary me-1" onclick="editProfessor({{ prof.id }})">
                    Edit
                </button>
                <button class="btn btn-sm btn-outline-danger" onclick="deleteProfessor({{ prof.id }})">
                    Delete
                </button>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteModalLabel">Confirm Deletion</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this professor? This action cannot be undone.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}